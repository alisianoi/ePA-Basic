<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="944px" preserveAspectRatio="none" style="width:1449px;height:944px;background:#FFFFFF;" version="1.1" viewBox="0 0 1449 944" width="1449px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="925.3047" style="stroke:#181818;stroke-width:0.5;" width="996.5" x="187" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="620.25" y="18.0669">ePA Aktensystem</text><rect fill="#FFFFFF" height="782.8516" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="269.5" y="136.4531"/><rect fill="#FFFFFF" height="607.9219" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="462.5" y="180.7188"/><rect fill="#FFFFFF" height="419.9922" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="716.5" y="267.1172"/><rect fill="#FFFFFF" height="135.6641" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="721.5" y="346.3828"/><rect fill="#FFFFFF" height="86.3984" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="1071.5" y="395.6484"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="425" x="613.5" y="569.4453"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="88" x2="88" y1="105.3203" y2="937.3047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="274" x2="274" y1="105.3203" y2="937.3047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="467" x2="467" y1="105.3203" y2="937.3047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="721.5" x2="721.5" y1="105.3203" y2="937.3047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1076.5" x2="1076.5" y1="105.3203" y2="937.3047"/><line style="stroke:#0000FF;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1399.5" x2="1399.5" y1="828.7734" y2="937.3047"/><rect fill="#3483EB" height="79.1875" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="126" x="25" y="25.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="86" y="45.1279"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="86" y="61.4248"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="59" y="77.7217">ePA-FdV</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="32" y="94.0186">&lt;&lt; Insurant &gt;&gt;</text><rect fill="#3483EB" height="79.1875" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="127" x="211" y="25.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="272.5" y="45.1279"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="272.5" y="61.4248"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="218" y="77.7217">Access Gateway</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="272.5" y="94.0186"> </text><rect fill="#EB5E34" height="79.1875" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="159" x="388" y="25.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="406" y="45.1279">VAU User Session</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="465.5" y="61.4248"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="395" y="77.7217">Authorization Service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="414.5" y="94.0186">&lt;&lt; Service &gt;&gt;</text><rect fill="#EB5E34" height="79.1875" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="156" x="643.5" y="25.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="660" y="45.1279">VAU User Session</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="719.5" y="61.4248"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="650.5" y="77.7217">Device Management</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="668.5" y="94.0186">&lt;&lt; Service &gt;&gt;</text><rect fill="#3483EB" height="79.1875" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="166" x="993.5" y="25.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="1074.5" y="45.1279"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="1074.5" y="61.4248"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="1000.5" y="77.7217">Device Unlock Service</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1023.5" y="94.0186">&lt;&lt; Service &gt;&gt;</text><rect fill="#FFFFFF" height="782.8516" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="269.5" y="136.4531"/><rect fill="#FFFFFF" height="607.9219" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="462.5" y="180.7188"/><rect fill="#FFFFFF" height="419.9922" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="716.5" y="267.1172"/><rect fill="#FFFFFF" height="135.6641" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="721.5" y="346.3828"/><rect fill="#FFFFFF" height="86.3984" style="stroke:#0000FF;stroke-width:1.0;" width="10" x="1071.5" y="395.6484"/><polygon fill="#1E90FF" points="257.5,132.4531,267.5,136.4531,257.5,140.4531,261.5,136.4531" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="88" x2="263.5" y1="136.4531" y2="136.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="95" y="131.3872">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="108" y="131.3872">Request to login</text><polygon fill="#1E90FF" points="450.5,176.7188,460.5,180.7188,450.5,184.7188,454.5,180.7188" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="279.5" x2="456.5" y1="180.7188" y2="180.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="286.5" y="168.0864">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="299.5" y="160.52">Route forwading to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="299.5" y="175.6528">Authorization Service</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="472.5" x2="514.5" y1="209.8516" y2="209.8516"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="514.5" x2="514.5" y1="209.8516" y2="222.8516"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="473.5" x2="514.5" y1="222.8516" y2="222.8516"/><polygon fill="#1E90FF" points="483.5,218.8516,473.5,222.8516,483.5,226.8516,479.5,222.8516" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="479.5" y="204.7856">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="492.5" y="204.7856">Get IDToken with no Device-Token</text><polygon fill="#1E90FF" points="704.5,263.1172,714.5,267.1172,704.5,271.1172,708.5,267.1172" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="472.5" x2="710.5" y1="267.1172" y2="267.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="479.5" y="254.4849">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="492.5" y="246.9185">Request to Device Management</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="492.5" y="262.0513">Registration API</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="726.5" x2="768.5" y1="296.25" y2="296.25"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="768.5" x2="768.5" y1="296.25" y2="309.25"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="727.5" x2="768.5" y1="309.25" y2="309.25"/><polygon fill="#1E90FF" points="737.5,305.25,727.5,309.25,737.5,313.25,733.5,309.25" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="733.5" y="291.1841">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="746.5" y="291.1841">Get the email address from the KVNR</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="726.5" x2="773.5" y1="333.3828" y2="333.3828"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="773.5" x2="773.5" y1="333.3828" y2="346.3828"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="732.5" x2="773.5" y1="346.3828" y2="346.3828"/><polygon fill="#1E90FF" points="742.5,342.3828,732.5,346.3828,742.5,350.3828,738.5,346.3828" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="738.5" y="328.3169">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="751.5" y="328.3169">Generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="815.5" y="328.3169">Device Token</text><polygon fill="#1E90FF" points="1059.5,391.6484,1069.5,395.6484,1059.5,399.6484,1063.5,395.6484" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="731.5" x2="1065.5" y1="395.6484" y2="395.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="738.5" y="383.0161">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="751.5" y="375.4497">Request to Device Unlock API</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="751.5" y="390.5825">with the email address</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1081.5" x2="1123.5" y1="439.9141" y2="439.9141"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1123.5" x2="1123.5" y1="439.9141" y2="452.9141"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1082.5" x2="1123.5" y1="452.9141" y2="452.9141"/><polygon fill="#1E90FF" points="1092.5,448.9141,1082.5,452.9141,1092.5,456.9141,1088.5,452.9141" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1088.5" y="427.2817">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="1101.5" y="419.7153">Generate a</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210" x="1177.5" y="419.7153">Device Verification Identifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1101.5" y="434.8481">and a</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="1141.5" y="434.8481">Verification Link</text><polygon fill="#1E90FF" points="737.5,478.0469,727.5,482.0469,737.5,486.0469,733.5,482.0469" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="731.5" x2="1075.5" y1="482.0469" y2="482.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="743.5" y="476.981">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="756.5" y="476.981">Response the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210" x="847.5" y="476.981">Device Verification Identifier</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="726.5" x2="768.5" y1="541.4453" y2="541.4453"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="768.5" x2="768.5" y1="541.4453" y2="554.4453"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="727.5" x2="768.5" y1="554.4453" y2="554.4453"/><polygon fill="#1E90FF" points="737.5,550.4453,727.5,554.4453,737.5,558.4453,733.5,554.4453" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="733.5" y="521.2466">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="755.5" y="506.1138">Save the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49" x="816.5" y="506.1138">Device</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="869.5" y="506.1138">object with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="966.5" y="506.1138">Device Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="755.5" y="521.2466">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="210" x="808.5" y="521.2466">Device Verification Identifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="755.5" y="536.3794">as</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="774.5" y="536.3794">pendig</text><path d="M613.5,569.4453 L677.5,569.4453 L677.5,576.5781 L667.5,586.5781 L613.5,586.5781 L613.5,569.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="425" x="613.5" y="569.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="628.5" y="582.5122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="341" x="692.5" y="581.6558">[In the case that it is an email from a representative]</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="726.5" x2="768.5" y1="607.7109" y2="607.7109"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="768.5" x2="768.5" y1="607.7109" y2="620.7109"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="727.5" x2="768.5" y1="620.7109" y2="620.7109"/><polygon fill="#1E90FF" points="737.5,616.7109,727.5,620.7109,737.5,624.7109,733.5,620.7109" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="733.5" y="602.645">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="755.5" y="602.645">Remove email address</text><polygon fill="#1E90FF" points="483.5,683.1094,473.5,687.1094,483.5,691.1094,479.5,687.1094" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="477.5" x2="720.5" y1="687.1094" y2="687.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="489.5" y="666.9106">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="511.5" y="651.7778">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="511.5" y="666.9106">message with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="511.5" y="682.0435">Device Token</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="472.5" x2="514.5" y1="716.2422" y2="716.2422"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="514.5" x2="514.5" y1="716.2422" y2="729.2422"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="473.5" x2="514.5" y1="729.2422" y2="729.2422"/><polygon fill="#1E90FF" points="483.5,725.2422,473.5,729.2422,483.5,733.2422,479.5,729.2422" style="stroke:#1E90FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="479.5" y="711.1763">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="501.5" y="711.1763">Close User Session</text><polygon fill="#1E90FF" points="290.5,784.6406,280.5,788.6406,290.5,792.6406,286.5,788.6406" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="284.5" x2="466.5" y1="788.6406" y2="788.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="296.5" y="768.4419">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="318.5" y="753.3091">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="318.5" y="768.4419">message with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="318.5" y="783.5747">Device Token</text><polygon fill="#1E90FF" points="1343.5,828.9063,1353.5,832.9063,1343.5,836.9063,1347.5,832.9063" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1076.5" x2="1349.5" y1="832.9063" y2="832.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1083.5" y="820.2739">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="1105.5" y="812.7075">Send</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40" x="1142.5" y="812.7075">email</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="1186.5" y="812.7075">with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="1105.5" y="827.8403">Verification Link</text><rect fill="#3483EB" height="30.2969" rx="2.5" ry="2.5" style="stroke:#3483EB;stroke-width:0.5;" width="88" x="1355.5" y="799.6094"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="1362.5" y="819.6045">Mail Server</text><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1076.5" x2="1118.5" y1="867.0391" y2="867.0391"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1118.5" x2="1118.5" y1="867.0391" y2="880.0391"/><line style="stroke:#1E90FF;stroke-width:1.0;" x1="1083.5" x2="1118.5" y1="880.0391" y2="880.0391"/><line style="stroke:#1E90FF;stroke-width:2.0;" x1="1082.5" x2="1092.5" y1="875.0391" y2="885.0391"/><line style="stroke:#1E90FF;stroke-width:2.0;" x1="1082.5" x2="1092.5" y1="885.0391" y2="875.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1083.5" y="861.9731">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1105.5" y="861.9731">Remove email address</text><polygon fill="#1E90FF" points="99,915.3047,89,919.3047,99,923.3047,95,919.3047" style="stroke:#1E90FF;stroke-width:1.0;"/><line style="stroke:#1E90FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="93" x2="273.5" y1="919.3047" y2="919.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="105" y="906.6724">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="127" y="899.106">Response message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="127" y="914.2388">with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="156" y="914.2388">Device Token</text><!--MD5=[e11148afc2362dd20deaedf49a667b89]
@startuml devicemanagement.registration

skinparam Shadowing false
skinparam ParticipantPadding 20
skinparam BoxPadding 10

skinparam participant {
    BackgroundColor #3483eb
    BorderColor #3483eb
    FontSize 14
    FontColor White
}

skinparam sequence {
    ArrowColor DodgerBlue
    ActorBorderColor DodgerBlue
    LifeLineBorderColor Blue
    ActorBackgroundColor #3483eb
    ActorFontSize 14
    NoteBackgroundColor #3483eb
}

hide footbox
autonumber

participant "\n\nePA-FdV\n<< Insurant >>" as fdv
box "ePA Aktensystem"
participant "\n\nAccess Gateway\n" as gateway
participant "VAU User Session\n\nAuthorization Service\n<< Service >>" as auth #eb5e34
participant "VAU User Session\n\nDevice Management\n<< Service >>" as dm #eb5e34
participant "\n\nDevice Unlock Service\n<< Service >>" as dus
end box
participant "Mail Server" as mail


fdv -> gateway : Request to login
activate gateway

gateway -> auth : Route forwading to\nAuthorization Service 
activate auth
auth -> auth : Get IDToken with no Device-Token
auth -> dm : Request to Device Management\nRegistration API

activate dm
dm -> dm: Get the email address from the KVNR
dm -> dm : Generate <b>Device Token</b>
activate dm

dm -> dus : Request to Device Unlock API\nwith the email address
activate dus

dus -> dus : Generate a <b>Device Verification Identifier</b>\nand a <b>Verification Link</b>
dus - -> dm : Response the <b>Device Verification Identifier</b>
deactivate dus

deactivate dm
dm -> dm : Save the <b>Device</b> object with the <b>Device Token</b>\nand the <b>Device Verification Identifier</b>\nas <b>pendig</b>
alt In the case that it is an email from a representative
dm -> dm : Remove email address 
end

dm - -> auth : Response\nmessage with\n<b>Device Token</b>
deactivate dm
auth -> auth : Close User Session
auth - -> gateway : Response\nmessage with\n<b>Device Token</b>
deactivate auth

create mail
dus -> mail : Send <b>email</b> with the\n<b>Verification Link</b>
dus -x dus : Remove email address 

deactivate dm

gateway - -> fdv : Response message\nwith <b>Device Token</b>
deactivate gateway



@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>